import{t as O}from"./date-Ctp1FiBW.js";import{e as m,eQ as $,eR as F,eS as I,aa as N,eT as C}from"./index-c9VjcUA7.js";const E={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function w(e){return E[e]}function*j(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*R(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const n of t)yield*n}}function*x(e,t={}){const{geometryType:n,objectIdField:o}=t;for(const r of e){const{geometry:c,properties:y,id:i}=r;if(c&&w(c.type)!==n)continue;const f=y||{};let u;o&&(u=f[o],i==null||u||(f[o]=u=i)),yield new N(c?Z(new C,c,t):null,f,null,u)}}function D(e){for(const t of e)if(t.length>2)return!0;return!1}function J(e){return!k(e)}function A(e){return k(e)}function k(e){let t=0;for(let n=0;n<e.length;n++){const o=e[n],r=e[(n+1)%e.length];t+=o[0]*r[1]-r[0]*o[1]}return t<=0}function G(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function Z(e,t,n){switch(t.type){case"LineString":return v(e,t,n);case"MultiLineString":return H(e,t,n);case"MultiPoint":return Q(e,t,n);case"MultiPolygon":return q(e,t,n);case"Point":return z(e,t,n);case"Polygon":return B(e,t,n)}}function v(e,t,n){return d(e,t.coordinates,n),e}function H(e,t,n){for(const o of t.coordinates)d(e,o,n);return e}function Q(e,t,n){return d(e,t.coordinates,n),e}function q(e,t,n){for(const o of t.coordinates){M(e,o[0],n);for(let r=1;r<o.length;r++)T(e,o[r],n)}return e}function z(e,t,n){return P(e,t.coordinates,n),e}function B(e,t,n){const o=t.coordinates;M(e,o[0],n);for(let r=1;r<o.length;r++)T(e,o[r],n);return e}function M(e,t,n){const o=G(t);J(o)?L(e,o,n):d(e,o,n)}function T(e,t,n){const o=G(t);A(o)?L(e,o,n):d(e,o,n)}function d(e,t,n){for(const o of t)P(e,o,n);e.lengths.push(t.length)}function L(e,t,n){for(let o=t.length-1;o>=0;o--)P(e,t[o],n);e.lengths.push(t.length)}function P(e,t,n){const[o,r,c]=t;e.coords.push(o,r),n.hasZ&&e.coords.push(c||0)}function K(e){switch(typeof e){case"string":return O(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function W(e,t=4326){if(!e)throw new m("geojson-layer:empty","GeoJSON data is empty");if(e.type!=="Feature"&&e.type!=="FeatureCollection")throw new m("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:n}=e;if(!n)return;const o=typeof n=="string"?n:n.type==="name"?n.properties.name:n.type==="EPSG"?n.properties.code:null,r=$({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!o||!r.test(o))throw new m("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:n})}function X(e,t={}){const n=[],o=new Set,r=new Set;let c,y=!1,i=null,f=!1,{geometryType:u=null}=t;for(const p of j(e)){const{geometry:h,properties:l,id:a}=p;if((!h||(u||(u=w(h.type)),w(h.type)===u))&&(y||(y=D(R(h))),f||(f=a!=null,f&&(c=typeof a,l&&(i=Object.keys(l).filter(s=>l[s]===a)))),l&&i&&f&&a!=null&&(i.length>1?i=i.filter(s=>l[s]===a):i.length===1&&(i=l[i[0]]===a?i:[])),l))for(const s in l){if(o.has(s))continue;const S=K(l[s]);if(S==="unknown"){r.add(s);continue}r.delete(s),o.add(s);const b=F(s);b&&n.push({name:b,alias:s,type:S})}}const g=F((i==null?void 0:i.length)===1&&i[0]||null)??void 0;if(g){for(const p of n)if(p.name===g&&I(p)){p.type="esriFieldTypeOID";break}}return{fields:n,geometryType:u,hasZ:y,objectIdFieldName:g,objectIdFieldType:c,unknownFields:Array.from(r)}}function Y(e,t){return Array.from(x(j(e),t))}export{W as E,X as I,Y as N,w as u};
