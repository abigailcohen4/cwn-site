const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-wPoPq8Rn.js","assets/index-BYxjBcjz.js","assets/index-BsXZDNwk.js","assets/index-DHNSHnXL.css","assets/dom-B-OqUviu.js","assets/observers-DW8aQIro.js","assets/logger-B3tWeDiv.js","assets/ref-CJVVqIaT.js","assets/directive-helpers-C4p57G5b.js","assets/component-CuBrpZJU.js","assets/interactive-BX2_koRO.js","assets/key-ak3_eHKH.js","assets/useT9n-BcksaeCr.js","assets/index-CXTXfB-n.js","assets/index-DKKneFFQ.js","assets/guid-BDWAkmkV.js","assets/index-B_qBqUyV.js","assets/keyed-BNY8wyWG.js","assets/index-CX9cgAe4.js","assets/customElement-CheQySN2.js","assets/index-gO9-Sxwn.js","assets/live-DYEMiz4Z.js","assets/static-C_hOQPr7.js","assets/form-Bitjm2fD.js","assets/label-DTDNrxU7.js","assets/locale-BZ36-s7O.js","assets/Validation-DnEui9DO.js","assets/input-Ceuqybnm.js","assets/filter-pONmcIs3.js","assets/debounce-DbkufipY.js","assets/utils-ZaPC3RfE.js","assets/index-BEZB_-tf.js","assets/index-CNXVLzWZ.js","assets/floating-ui-Dv7_Pv7C.js","assets/openCloseComponent-DQgBX-BR.js","assets/dynamicClasses-Dlk4kLaw.js","assets/index-DUr6ub-u.js","assets/index-DXnTKrV3.js","assets/resources6-C-XXGpuo.js","assets/index-C5nsEDjo.js","assets/customElement-VYcl6jOR.js","assets/resources5-B_fF8ZZV.js","assets/index-D7UcCH1W.js","assets/FloatingArrow-umTNNU-q.js","assets/Popup-CfJOOe_G.js","assets/executeQueryJSON-Cqz-3ThX.js","assets/query-Dut5PRZc.js","assets/pbfQueryUtils-CUnA2cKU.js","assets/pbf-qHsCUNdc.js","assets/shared-D_1Bdgwo.js"])))=>i.map(i=>d[i]);
import{hP as A,hQ as g,hR as w,hS as F,_ as h,hT as o,hU as E,hV as V,hW as y,hX as m,hY as T,hZ as v,h_ as b,h$ as L,r as a,m as d,a as $}from"./index-BsXZDNwk.js";var _;const M="esri-feature-utility-network-associations",I={base:M,listItemHidden:`${M}__list-item--hidden`},C="nested";let n=_=class extends A{constructor(e,t){super(e,t),this.description=null,this.flowItems=null,this.flowType="feature-utility-network-association-type",this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new g,this.visibleElements=new w}initialize(){this.setUpObserver()}loadDependencies(){return F({chip:()=>h(()=>import("./index-wPoPq8Rn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),icon:()=>h(()=>import("./index-BYxjBcjz.js"),__vite__mapDeps([1,2,3,4,5,6])),list:()=>h(()=>import("./index-CXTXfB-n.js"),__vite__mapDeps([13,14,2,3,15,12,16,7,8,5,4,17,1,6,18,19,20,21,22,23,10,11,24,9,25,26,27,28,29,30])),"list-item":()=>h(()=>import("./index-BEZB_-tf.js"),__vite__mapDeps([31,1,2,3,4,5,6,32,7,8,33,29,15,10,11,9,34,35,14,12,36,17,37,38,39,40,30,41])),tooltip:()=>h(()=>import("./index-D7UcCH1W.js"),__vite__mapDeps([42,2,3,7,8,33,4,29,15,34,43,17]))})}destroy(){this.tooltipReferenceMap.clear()}render(){var l;const e=this.viewModel.associationViewModels,{state:t,showAllEnabled:s}=this.viewModel,{state:i}=this.parentFeatureViewModel??{};return o("div",{class:this.classes(I.base,V.widget)},t==="loading"||t==="querying"||i==="loading"?this.renderLoading():o("calcite-list",{displayMode:C,label:((l=this.selectedLayer)==null?void 0:l.title)??this.messagesCommon.untitled},s&&this.selectedLayer?o(E,null,this.renderFilter(),this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):Array.from(e.keys(),r=>this._renderTypeList(r,e.get(r)))))}_showAllAssociations(e){const{flowItems:t,viewModel:s,description:i}=this;if(!t||!e)return;s.showAllEnabled=!0;const l=new _({selectedLayer:e,title:e==null?void 0:e.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:i,visibleElements:new w({title:!1,description:!1}),viewModel:s});t.push(l)}_renderAssociatedFeatureListPage(){const e=this.viewModel.associationViewModels.get(this.selectedLayer).filter(t=>y(t.featureViewModel).toLowerCase().includes(this.filterText)).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this;return m(e.association)?o("calcite-tooltip",{key:`tooltip-${e.featureViewModel.uid}`,overlayPositioning:"fixed",referenceElement:t.get(e.featureViewModel.uid)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){const{featureViewModel:t}=e,s=y(t),i=t.state==="loading",l=this._findFlowItem(t),r=l<0&&this._isParentFeature(t),c=r||l>=0;return o("calcite-list-item",{class:i?I.listItemHidden:void 0,description:b(e.terminalName??""),key:`associated-feature-type-${t.uid}`,label:b(s),onCalciteListItemSelect:()=>this._handleFeatureClick(r,l,t)},m(e.association)?this.renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,T(e.association)?o("calcite-chip",{label:v(e.association),scale:"s",slot:"content-end"},v(e.association)):null,this._renderChevronIconNode(c))}async _selectAssociation(e){const{flowItems:t,featureVisibleElements:s}=this;if(!t)return;e.abilities={utilityNetworkAssociationsContent:!0};const{default:i}=await h(()=>import("./Popup-CfJOOe_G.js").then(l=>l.F),__vite__mapDeps([44,2,3,45,46,47,48,49]));t.push(new i({flowItems:t,flowType:"feature-association",viewModel:e,visibleElements:s}))}_handleFeatureClick(e,t,s){if(e)this.flowItems.drain(i=>{"showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(s);else for(;this.flowItems.length>t+1;){const i=this.flowItems.pop();i&&("showAllEnabled"in i.viewModel&&(i.viewModel.showAllEnabled=!1),i.viewModel=null,i.destroy())}}_featureViewModelMatch(e,t){const s=e.graphic,i=s==null?void 0:s.layer;let l=null;(i==null?void 0:i.type)==="subtype-sublayer"&&i.parent?l=i.parent.globalIdField??null:i&&"globalIdField"in i&&(l=i.globalIdField);const r=l?s==null?void 0:s.attributes[l]:null,c=t.graphic,u=c==null?void 0:c.layer;let p=null;(u==null?void 0:u.type)==="subtype-sublayer"&&u.parent?p=u.parent.globalIdField??null:u&&"globalIdField"in u&&(p=u.globalIdField);const f=p?c==null?void 0:c.attributes[p]:null;return r&&f&&r===f}_isParentFeature(e){var i;const t=(i=this.flowItems)==null?void 0:i.getItemAt(0);if(!t)return!1;const s=t.parentFeatureViewModel;return this._featureViewModelMatch(s,e)}_findFlowItem(e){var t;return((t=this.flowItems)==null?void 0:t.findIndex(s=>{if(s.flowType!=="feature-association")return!1;const i=s.viewModel;return this._featureViewModelMatch(i,e)}))??-1}_renderTooltips(e){return e.toArray().map(t=>this._renderItemTooltip(t))}_renderAssociatedFeatureList(e){return e.toArray().map(t=>this._renderAssociatedFeature(t))}_renderChevronIconNode(e){return o("calcite-icon",{flipRtl:!0,icon:e?"move-up":"chevron-right",scale:"s",slot:"content-end"})}_renderTypeList(e,t){const{messagesFeature:s}=this,{displayCount:i}=this.viewModel,l=t.slice(0,i),r=l.length<t.length;return o("calcite-list-item",{key:"show-all",label:e.title,open:!0,value:e.id},o("calcite-chip",{label:String(t.length),scale:"s",slot:"content-end"},t.length),o("calcite-list",{group:e.id,label:e.title??""},[this._renderTooltips(l),this._renderAssociatedFeatureList(l)],r?o("calcite-list-item",{description:L(s==null?void 0:s.numberRecords,{number:t.length.toString()}),key:"show-all-item",label:s.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},o("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})):null))}};a([d()],n.prototype,"description",void 0),a([d()],n.prototype,"featureVisibleElements",void 0),a([d()],n.prototype,"flowItems",void 0),a([d()],n.prototype,"flowType",void 0),a([d()],n.prototype,"listType",void 0),a([d()],n.prototype,"parentFeatureViewModel",void 0),a([d()],n.prototype,"title",void 0),a([d({type:g})],n.prototype,"viewModel",void 0),a([d({type:w,nonNullable:!0})],n.prototype,"visibleElements",void 0),n=_=a([$("esri.widgets.Feature.FeatureUtilityNetworkAssociationList")],n);const k=n;export{k as default};
