import{r as n,m as s,a as _,g as wt,V as nt,h as Pt,aS as st,rM as H,er as V,r2 as At,e9 as Ot,wE as R,iA as Et,rA as St,jO as Ct,wF as Mt,wG as Ft,b0 as Ht,ks as _t,hK as zt,G as Lt,D as Nt,wH as rt,F as Dt,Z as Zt,u as J,A as jt,a3 as N,q4 as Yt,cu as A,cE as E,r9 as at,wI as Kt,wJ as Jt,ee as Qt,mj as qt,ml as lt,cb as Wt,cU as q,wK as Z,cV as Xt,e8 as ct,de as pt,cT as dt,wL as ut}from"./index-Cq4wNgzh.js";import{r as I,V as Bt,R as te,b as ee,c as ie,O as oe}from"./SketchTooltipInfo-BQozoTkz.js";import{a as ne}from"./dehydratedFeatureComparison-C5nS6hw8.js";import{Z as se,a as re,L as ht,v as ae,T as yt,b as le,j as ce,R as gt,d as pe}from"./drawSurfaces-Cd8CCN6y.js";import{getDrawMeshHelpMessage as de}from"./helpMessageUtils3d-DUhsHncf.js";import{h as z,k as ue,R as he,y as kt,F as xt,Q as ye,w as ge,u as $t}from"./automaticAreaMeasurementUtils-BO74ulvU.js";import{c as me,m as j}from"./automaticLengthMeasurementUtils-WGy8ka9D.js";import{j as ve,R as fe}from"./quantityFormatUtils-DWdnfPeK.js";import{n as we}from"./InteractiveToolBase-DFJ7NuD4.js";import{t as Oe,c as _e,e as ke,d as xe}from"./EditGeometryOperations-C-7JpxX-.js";var y;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(y||(y={}));var O;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(O||(O={}));const Y={[O.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[O.UndoInvalidError]:"There are no items to Undo",[O.RedoInvalidError]:"There are no items to Redo",[O.ApplyInvalidError]:"Cannot apply an item that is already applied"};class S extends Error{constructor(){super(Y[O.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}let W=class extends Error{constructor(){super(Y[O.UndoInvalidError]),this.type="undo-redo-undo-error"}};class mt extends Error{constructor(){super(Y[O.RedoInvalidError]),this.type="undo-redo-redo-error"}}class $e extends Error{constructor(){super(Y[O.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var x;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(x||(x={}));let D=class extends wt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=y.NeverApplied}get canUndo(){return this.status===y.Applied}get canRedo(){return this.status===y.Undone}async executeUndoRedoOperation(t){switch(t){case x.Apply:if(this.status!==y.NeverApplied)throw new $e;return await this.apply(),void(this.status=y.Applied);case x.Undo:if(this.status!==y.Applied)throw new W;return await this.undo(),void(this.status=y.Undone);case x.Redo:if(this.status!==y.Undone)throw new W;return await this.redo(),void(this.status=y.Applied)}}};n([s()],D.prototype,"name",void 0),n([s()],D.prototype,"tag",void 0),D=n([_("esri.undoredo.UndoableOperation")],D);let f=class extends wt{constructor(){super(...arguments),this._stack=new nt,this._stackPosition=-1,this._updatingHandles=new Pt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new W;if(this.updating)throw new S;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(x.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new mt;if(this.updating)throw new S;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new mt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(x.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new S;await this._updatingHandles.addPromise((async()=>{t.status===y.NeverApplied&&await t.executeUndoRedoOperation(x.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new S;await this._updatingHandles.addPromise((async()=>{t.status===y.NeverApplied&&await t.executeUndoRedoOperation(x.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await st(()=>!this.updating);const i=new nt;for(let o=0;o<this._stack.length;o++){const r=this._stack.getItemAt(o);r&&(r.tag===t?(r.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(r))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new S;await st(()=>!this.updating),this._drainStack()}};n([s()],f.prototype,"_stack",void 0),n([s()],f.prototype,"_stackPosition",void 0),n([s()],f.prototype,"updating",null),n([s({readOnly:!0})],f.prototype,"canUndo",null),n([s({readOnly:!0})],f.prototype,"hasUndo",null),n([s({readOnly:!0})],f.prototype,"canRedo",null),n([s({readOnly:!0})],f.prototype,"hasRedo",null),f=n([_("esri.UndoRedo")],f);class be{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}let w=class extends I{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=H}get allFields(){return[]}};n([s()],w.prototype,"type",void 0),n([s()],w.prototype,"radius",void 0),n([s()],w.prototype,"xSize",void 0),n([s()],w.prototype,"ySize",void 0),n([s()],w.prototype,"area",void 0),n([s()],w.prototype,"helpMessage",void 0),n([s()],w.prototype,"allFields",null),w=n([_("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],w);let C=class extends z(I){constructor(e){super(e),this.type="draw-mesh",this.orientation=ue({lockable:!1}),this.scale=he({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([s()],C.prototype,"helpMessage",void 0),n([s()],C.prototype,"allFields",null),C=n([_("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],C);let M=class extends z(I){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([s()],M.prototype,"helpMessage",void 0),n([s()],M.prototype,"allFields",null),M=n([_("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],M);let F=class extends z(I){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([s()],F.prototype,"helpMessage",void 0),n([s()],F.prototype,"allFields",null),F=n([_("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],F);let U=class extends z(I){constructor(e){super(e),this.type="draw-polygon",this.direction=kt(),this.distance=xt(),this.area=ye(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([s()],U.prototype,"xyMode",void 0),n([s()],U.prototype,"helpMessage",void 0),n([s()],U.prototype,"allFields",null),U=n([_("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],U);let T=class extends z(I){constructor(t){super(t),this.type="draw-polyline",this.direction=kt(),this.distance=xt(),this.totalLength=ge(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([s()],T.prototype,"helpMessage",void 0),n([s()],T.prototype,"xyMode",void 0),n([s()],T.prototype,"allFields",null),T=n([_("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],T);let k=class extends I{constructor(t){super(t),this.type="draw-rectangle",this.xSize=V,this.ySize=V,this.area=H}get allFields(){return[]}};n([s()],k.prototype,"type",void 0),n([s()],k.prototype,"xSize",void 0),n([s()],k.prototype,"ySize",void 0),n([s()],k.prototype,"area",void 0),n([s()],k.prototype,"helpMessage",void 0),n([s()],k.prototype,"allFields",null),k=n([_("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],k);function Ve(t,e){return{point:new F({sketchOptions:e,viewType:t}),multipoint:new M({sketchOptions:e,viewType:t}),polyline:new T({sketchOptions:e,viewType:t}),polygon:new U({sketchOptions:e,viewType:t}),mesh:new C({sketchOptions:e,viewType:t}),rectangle:new k({sketchOptions:e}),circle:new w({sketchOptions:e})}}function vt(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:r}=t,d=u=>{const l=K(t).mode,h=r[u].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?h.lock(tt(t)):h.unlock()},a=u=>{if(e){const l=r[u].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":d(i),a(i);break;case"point":case"mesh":d(i)}}function Ie(t,e){const{drawOperation:i,view:o}=e,r=X(e),d=K(e);if(o.type==="2d"||!t||d.mode!=="absolute-height"||(i==null?void 0:i.numCommittedVertices)!==1||!r||r.type!=="draw-polyline"&&r.type!=="draw-polygon"||r.elevation.locked)return;const[a,u,l]=t,h=ze(a,u,l,d,e);h!=null&&r.elevation.lock(h)}function ft(t){var e;(e=X(t))==null||e.allFields.forEach(i=>{i.unlockOnVertexPlacement&&i.unlock()})}function X({geometryType:t,graphic:e,tooltipInfos:i}){var o;return((o=e==null?void 0:e.geometry)==null?void 0:o.type)!==Ue[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const Ue={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function Te(t,e){switch(t==null?void 0:t.type){case"draw-point":Re(t,e);break;case"draw-multipoint":Ge(t,e);break;case"draw-polyline":Ae(t,e);break;case"draw-polygon":Ee(t,e);break;case"draw-rectangle":Ce(t,e);break;case"draw-circle":Me(t,e);break;case"draw-mesh":Pe(t,e)}}function Re(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="point"&&(B(t,i,e),t.helpMessage=R("point",i,e.drawOperation.drawingMode))}function Ge(t,e){var o;const i=(o=e.graphic)==null?void 0:o.geometry;(i==null?void 0:i.type)==="multipoint"&&(B(t,i,e),t.helpMessage=R("multipoint",i,e.drawOperation.drawingMode))}function Pe(t,e){const{graphic:i,view:o}=e,r=i==null?void 0:i.geometry;o.type!=="3d"||r&&r.type!=="mesh"||(B(t,r==null?void 0:r.origin,e),r&&Bt(t,r),t.helpMessage=de(i,o))}function B(t,e,i){const{drawOperation:o,view:r,sketchOptions:d}=i,{cursorVertex:a}=o;t.sketchOptions=d,t.viewType=r.type;const u=(e==null?void 0:e.type)==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(u,G(i)),Vt(t.elevation,i),!a)return void(o.constraints=void 0);const l=a;o.constraints={context:Rt(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Ae(t,e){const{createOperationGeometry:i,drawOperation:o}=e,r=i!=null?i.full:null;r&&r.type!=="polyline"||(bt(t,e),t.totalLength.actual=o.lastVertex?(r?me(r):null)??V:null,t.helpMessage=R("polyline",r,e.drawOperation.drawingMode))}function Ee(t,e){const{createOperationGeometry:i,drawOperation:o}=e,r=i!=null?i.full:null;r&&r.type!=="polygon"||(bt(t,e),t.area.actual=o.lastVertex?(r?$t(r):null)??H:null,t.helpMessage=R("polygon",r,e.drawOperation.drawingMode))}function bt(t,e){const{drawOperation:i,sketchOptions:o,view:r}=e,{cursorVertex:d,lastVertex:a,secondToLastVertex:u}=i,l=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=r.type;const h=a&&d?j(a,d)??V:null;if(t.distance.actual=h,t.distance.readOnly=a==null,t.direction.actual=null,t.direction.readOnly=!0,a&&d&&(l==="absolute"||u)){const $=Mt(u,a,d,l);t.direction.actual=$??Ft,t.direction.readOnly=!1}t.setLocationFromPoint(d,G(e)),Vt(t.elevation,e);const g=Se(a,e);t.xyMode=g,t.direction.visible=g==="direction-distance",t.distance.visible=g==="direction-distance",t.effectiveX.visible=g==="coordinates",t.effectiveY.visible=g==="coordinates";const v=d??a;i.constraints=v?{context:Rt(v,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Se(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Ce(t,e){var i;t.sketchOptions=e.sketchOptions,t.xSize=Ut(e),t.ySize=Tt(e),t.area=It(e),t.helpMessage=R("rectangle",(i=e.graphic)==null?void 0:i.geometry,e.drawOperation.drawingMode)}function Me(t,e){var r;const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Fe(e):null,t.xSize=i?null:Ut(e),t.ySize=i?null:Tt(e),t.area=It(e),t.helpMessage=R("circle",(r=e.graphic)==null?void 0:r.geometry,e.drawOperation.drawingMode)}function Vt(t,e){const{drawOperation:i}=e,o=(i==null?void 0:i.cursorVertex)??(i==null?void 0:i.lastVertex);t.actual=fe(o)??tt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function It(t){var i;const e=(i=t.createOperationGeometry)==null?void 0:i.full;return(e==null?void 0:e.type)!=="polygon"?H:$t(e)??H}function Ut(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?j(e.left,e.right):null)??V}function Tt(t){var i,o;const e=(o=(i=t.createOperationGeometry)==null?void 0:i.rectangle)==null?void 0:o.midpoints;return(e!=null?j(e.top,e.bottom):null)??V}function Fe({createOperationGeometry:t}){var e;return(((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?j(t.circle.center,t.circle.edge):null)??V}function He(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?At(o,"meters")/Ot(G(t)):void 0}default:return}}function ze(t,e,i,o,r){const{view:d,drawOperation:a}=r;if(d.type!=="3d"||!a)return;i??(i=0);const u=G(r),l=K(r),h=St(d,t,e,i,u,l,o);return ve(h,u)??tt(r)}function K(t){return t.drawOperation.elevationInfo??Et}function G(t){return t.drawOperation.coordinateHelper.spatialReference}function tt(t){const e=Ot(G(t));return Ct(t.defaultZ*e,"meters")}function Rt(t,e){return se(t,e.view,G(e),K(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let c=class extends Ht.EventedMixin(we){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new _t}initialize(){const{view:t}=this;this.internalGraphicsLayer=new zt({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Ve(t.type,this.sketchOptions);const i=te(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,vt(this._tooltipsContext),this._coordinateFormatterLoadTask=Lt(()=>ee()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>ie(o,this.activeTooltipInfo)),Nt(()=>this.cursor,o=>{e.cursor=o},Dt),rt(()=>{const{activeTooltipInfo:o,sketchOptions:r}=this;Te(o,this._tooltipsContext),i.info=r.tooltips.effectiveEnabled?o:null}),rt(()=>{e.constraintZ=He(this._tooltipsContext)},Zt)]),this.finishToolCreation()}destroy(){this.drawOperation=J(this.drawOperation),this.tooltip=J(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=J(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof f?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||oe(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&vt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(m.outline),this.removeHandles(m.regularVertices),this.removeHandles(m.activeVertex),this.removeHandles(m.activeEdge),this.removeHandles(Q)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new jt({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(N(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),Q),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var et,it;if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:r,committedVertices:d,geometryIncludingUncommittedVertices:a,numCommittedVertices:u}=this.drawOperation;if(!(u>0||o!=null))return;const l=t.operationComplete?d:a,h=l.length,g=o!=null?e.pointToArray(o):null,v=this._drawSpatialReference,$=i.type==="3d"&&i.viewingMode==="global",p=new be;p.committedVertices=d,p.cursorVertex=g;const{geometryType:P}=this;switch(P){case"point":case"mesh":p.full=e.arrayToPoint(l[0]);break;case"multipoint":p.full=h>0?pe(l,v):null;break;case"polyline":case"polygon":h>0&&(p.full=P==="polygon"?ce([l],v,$,!0):gt([l],v,$),p.cursorEdge=g!=null&&r&&!ne(o,r)?gt([[g,e.pointToArray(r)]],v,$):null,p.outline=h>1?p.full:null);break;case"circle":case"rectangle":{if(p.committedVertices=p.cursorVertex=null,!h)break;const b=re(i,l[0]),L=l[0],ot=b.makeMapPoint(L[0]+Le*i.resolution,L[1]);P==="circle"?h===1&&t.operationComplete?p.circle=ht([L,ot],b,!0):h===2&&(this.forceUniformSize?p.circle=ht(l,b,this.centered):p.rectangle=ae(l,b,this.centered)):h===1&&t.operationComplete?p.rectangle=yt([L,ot],b,!0):h===2&&(p.rectangle=this.forceUniformSize?yt(l,b,this.centered):le(l,b,this.centered)),p.full=p.circle!=null?p.circle.geometry:(et=p.rectangle)==null?void 0:et.geometry,p.outline=((it=p.full)==null?void 0:it.type)==="polygon"?p.full:null;break}default:return null}return p}initializeGraphic(t){return N()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return N()}onCursorEdgeChanged(t){return N()}onVertexAdd(t){var e;ft(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Ie((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){ft(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),m.activeEdge):this.removeHandles(m.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),m.outline):this.removeHandles(m.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),m.regularVertices):this.removeHandles(m.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),m.activeVertex):this.removeHandles(m.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(Q)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?X(this._tooltipsContext):null}};n([s()],c.prototype,"_coordinateFormatterLoadTask",void 0),n([s()],c.prototype,"_createOperationGeometry",void 0),n([s()],c.prototype,"_tooltipsContext",null),n([s({value:!0})],c.prototype,"centered",null),n([s()],c.prototype,"cursor",null),n([s({nonNullable:!0})],c.prototype,"defaultZ",void 0),n([s({constructOnly:!0})],c.prototype,"directionOptions",void 0),n([s()],c.prototype,"drawOperation",void 0),n([s()],c.prototype,"elevationLockOnVertexAddDisabled",void 0),n([s({value:!0})],c.prototype,"enabled",null),n([s({value:!0})],c.prototype,"forceUniformSize",null),n([s({constructOnly:!0})],c.prototype,"geometryType",void 0),n([s()],c.prototype,"graphic",null),n([s({constructOnly:!0})],c.prototype,"graphicProperties",void 0),n([s()],c.prototype,"graphicSymbol",null),n([s({constructOnly:!0})],c.prototype,"hasZ",void 0),n([s({constructOnly:!0})],c.prototype,"geometryToPlace",void 0),n([s()],c.prototype,"mode",null),n([s()],c.prototype,"snappingManager",void 0),n([s()],c.prototype,"snapToScene",void 0),n([s()],c.prototype,"tooltip",void 0),n([s()],c.prototype,"tooltipInfos",void 0),n([s({constructOnly:!0,type:_t})],c.prototype,"sketchOptions",void 0),n([s()],c.prototype,"updating",null),n([s({constructOnly:!0,nonNullable:!0})],c.prototype,"view",void 0),n([s({constructOnly:!0})],c.prototype,"undoRedo",null),n([s()],c.prototype,"activeTooltipInfo",null),c=n([_("esri.views.draw.DrawGraphicTool")],c);const Q=Symbol("create-operation-graphic"),m={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function ri(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Le=48;function ai(t,e){return Gt(t,e,!1)}function li(t,e){return Gt(t,e,!0)}function Gt(t,e,i){if(t instanceof Oe){if(t.operation instanceof _e)return Ne(t.operation,e,i),!0;if(t.operation instanceof ke)return De(t.operation,e,i),!0;if(t.operation instanceof xe)return Ze(t.operation,e,i),!0}return!1}function Ne(t,e,i=!1){const o=i?-1:1,r=Xt(o*t.dx,o*t.dy,o*t.dz);q(e.origin,e.origin,r),Z(e)}function De(t,e,i=!1){const o=i?-t.angle:t.angle;ct(e.basis1,e.basis1,pt,o),ct(e.basis2,e.basis2,pt,o),Z(e)}function Ze(t,e,i=!1){const o=i?1/t.factor1:t.factor1,r=i?1/t.factor2:t.factor2;dt(e.basis1,e.basis1,o),dt(e.basis2,e.basis2,r),ut(e.origin,e.origin,t.origin,t.axis1,o),ut(e.origin,e.origin,t.origin,t.axis2,r),Z(e)}function ci(t,e,i,o,r=!1){o||(o=Yt());const d=A(E.get(),t[1],-t[0]),a=A(E.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=A(E.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=E.get(),h=e.allVertices;h.forEach(({pos:p})=>{A(l,at(t,p),at(d,p)),Kt(a,a,l),Jt(u,u,l)});const g=1e-6,v=A(E.get(),u[0]-a[0]<g?i/2:0,u[1]-a[1]<g?i/2:0);Qt(a,a,v),qt(u,u,v);const $=r?h.reduce((p,P)=>p+(P.pos[2]??0),0)/h.length:0;return lt(o.basis1,t,(u[0]-a[0])/2),lt(o.basis2,d,(u[1]-a[1])/2),Wt(o.origin,a[0]*t[0]+a[1]*d[0],a[0]*t[1]+a[1]*d[1],$),q(o.origin,o.origin,o.basis1),q(o.origin,o.origin,o.basis2),Z(o),o}export{c as I,ri as M,ci as S,li as T,ai as V};
