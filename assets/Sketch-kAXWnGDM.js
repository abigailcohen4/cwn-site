const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-uo3QRyij.js","assets/index-CWuD1dO3.js","assets/index-CbbbHOt4.js","assets/index-DHNSHnXL.css","assets/guid-BDWAkmkV.js","assets/useT9n-E5rI7e4u.js","assets/index-CKY2pbvv.js","assets/dom-BRPpRYGF.js","assets/observers-5QNvkVd1.js","assets/logger-BGa3V1Ws.js","assets/keyed-DkRs_R1P.js","assets/directive-helpers-JD9fXJbT.js","assets/ref-DfEI74p4.js","assets/interactive-h5hspX8P.js","assets/component-xKr-KZjB.js","assets/index-CeuWjGvT.js","assets/index-W1Nzc8kd.js","assets/floating-ui-CGev6s1M.js","assets/debounce-DbkufipY.js","assets/openCloseComponent-BYSaKS_V.js","assets/static-BO8BAT71.js","assets/FloatingArrow-BZNCQCKq.js","assets/useFocusTrap-Cz4DMkFZ.js","assets/key-ak3_eHKH.js","assets/index-D4v05KrG.js","assets/array-CItZ4bXf.js","assets/index-DP7sB_Vc.js","assets/ExpandToggle-BaIXqidf.js","assets/index-DCaoM_3N.js","assets/geometryEngineJSON-Bvf5zUh7.js","assets/geometryEngineBase-B0ZyeKAX.js","assets/_commonjsHelpers-DCkdB7M8.js","assets/json-Wa8cmqdu.js","assets/index-Bp_8Rx7Z.js"])))=>i.map(i=>d[i]);
import{r as n,m as l,a as O,hT as u,ve as Me,qN as D,hS as W,_ as M,hU as de,qQ as H,g as pe,V as ue,u as Q,bA as he,hL as ee,vf as Oe,oV as Ce,bD as ke,iD as $e,iE as Se,b0 as Z,a3 as ve,i9 as X,k1 as Ee,vg as ge,vh as me,vi as Ie,vj as Pe,vk as K,iy as G,pM as Re,f as xe,vl as Le,j_ as te,gs as Ae,G as Ve,dX as De,mE as U,aH as ze,kr as He,j as Ge,m6 as Be,D as V,dW as B,kq as oe,pG as j,p as F,dp as J,hV as Fe,dw as We,vm as ye,vn as _e,q as Ue,F as ie,vo as z,vp as Ke,vq as je,vr as Ne,h$ as se,vs as qe,vt as Qe}from"./index-CbbbHOt4.js";import{o as Ze}from"./mat2df64-CBKYtunK.js";import{F as Xe,u as re,W as Je,L as Ye,T as et,v as tt,b as ot}from"./drawSurfaces-C8o-6HUC.js";import{n as it}from"./InteractiveToolBase-CPHUFZBE.js";import"./geometryEngine-Fo8OufBq.js";import"./geometryEngineBase-B0ZyeKAX.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-BxbyRUCj.js";import"./memoize-DmxaQ-k8.js";import"./dehydratedFeatureComparison-Buuh-M1d.js";import"./EditGeometryOperations-CmidSGd0.js";import"./SnappingContext-lR2hMWGP.js";import"./SnappingOperation-COie0ek2.js";const w={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},fe={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"};function we(t,e){var o;return t.vnodeSelector===e?[t]:((o=t.children)==null?void 0:o.flatMap(i=>we(i,e)))??[]}const Y=t=>{let e=class extends t{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){var o;(o=this.measurementManager)==null||o.managedElements.remove(this),this.measurementManager=null}set measurementManager(o){const i=this._get("measurementManager");o!==i&&(i&&i.managedElements.remove(this),this._set("measurementManager",o),o==null||o.managedElements.add(this))}set budgetedLength(o){this.budgetedLength!==o&&(this._set("budgetedLength",o),this.scheduleRender())}get actionChildren(){var o;return((o=this.children)==null?void 0:o.flatMap(i=>we(i,"calcite-action")))??[]}get activeChildElement(){var i;const o=this.actionChildren.find(s=>{var r;return((r=s.properties)==null?void 0:r.active)===!0});return o?(this._set("lastActiveKey",(i=o.properties)==null?void 0:i.key),o):this.lastActiveKey?this.actionChildren.find(s=>{var r;return((r=s.properties)==null?void 0:r.key)===this.lastActiveKey}):void 0}_handleClick(o){o!=null&&o.dataset&&"dataset"in o&&o.dataset.actionKey&&(this.lastActiveKey=o.dataset.actionKey)}};return n([l()],e.prototype,"priority",void 0),n([l()],e.prototype,"measurementManager",null),n([l()],e.prototype,"budgetedLength",null),n([l()],e.prototype,"actionChildren",null),n([l()],e.prototype,"activeChildElement",null),n([l()],e.prototype,"scale",void 0),n([l()],e.prototype,"slot",void 0),n([l()],e.prototype,"lastActiveKey",void 0),n([l()],e.prototype,"layout",void 0),e=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],e),e},ne=Symbol("on-resize-handle-key");let x=class extends Y(D){constructor(t){super(t),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return[this.layout==="horizontal"?this._measuredWidth:this._measuredHeight]}render(){return u("div",{afterCreate:t=>{this._measuredElement=t.firstElementChild,this.addHandles(Me(this._measuredElement,()=>{var e,o;this._measuredWidth=((e=this._measuredElement)==null?void 0:e.clientWidth)??0,this._measuredHeight=((o=this._measuredElement)==null?void 0:o.clientHeight)??0}),ne)},afterRemoved:()=>this.removeHandles(ne)},this.children)}};n([l()],x.prototype,"_measuredWidth",void 0),n([l()],x.prototype,"_measuredHeight",void 0),n([l()],x.prototype,"lengthOptions",null),n([l()],x.prototype,"_measuredElement",void 0),x=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],x);const st=x;let I=class extends Y(D){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return W({action:()=>M(()=>import("./index-uo3QRyij.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),"action-group":()=>M(()=>import("./index-CeuWjGvT.js").then(e=>e.i),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,24,25])),"action-menu":()=>M(()=>import("./index-D4v05KrG.js").then(e=>e.i),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,25]))})}get minimumLength(){const{actionChildren:e,scale:o}=this;return e.length?this.allowCollapse?w.groupSeparator+w.action[o]*Math.min(e.length,2):w.groupSeparator+w.action[o]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:o,minimumLength:i,allowCollapse:s,priority:r}=this,a=[i];if(e.length<=2||!s||r<1)return a;for(let c=1;c<e.length-1;c++)a.push(i+w.action[o]*c);return a}render(){if(!this.actionChildren.length)return u(de,null,void 0);const{budgetedLength:e,actionChildren:o,activeChildElement:i,layout:s,slot:r,scale:a}=this,c=Math.floor(e/w.action[a]),p=[],d=[];if(c>=o.length)p.push(...o);else{const v=i??p.at(0);if(p.push(...o.slice(0,c-1)),d.push(...o.slice(c-1)),v&&d.includes(v)){const[_]=d.splice(d.indexOf(v),1),g=p.pop();p.push(_),g&&d.unshift(g)}}return u("calcite-action-group",{key:"overflow-button-group",layout:s,onclick:v=>this._handleClick(v.target),slot:r},p.map(v=>this._renderManagedAction(v)),d.length>0?u("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},u("calcite-action",{icon:fe.overflow,key:"split-button-dropdown-trigger",scale:a,slot:"trigger",text:this.messagesCommon.more}),d.map(v=>this._renderManagedAction(v))):void 0)}_renderManagedAction(e){var o,i;return u("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(o=e==null?void 0:e.properties)==null?void 0:o.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};I.vnodeSelector="calcite-action-group",n([l()],I.prototype,"allowCollapse",void 0),n([l()],I.prototype,"minimumLength",null),n([l(),H("esri/t9n/common")],I.prototype,"messagesCommon",void 0),n([l()],I.prototype,"lengthOptions",null),I=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],I);const rt=I;let P=class extends pe{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new ue,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((t,e)=>e.priority-t.priority)}connect(t){this._resizeObserver.disconnect(),this.measuredElement=t,this._resizeObserver.observe(t),this._measure()}allocate(){const t=new Map,{availableLength:e,_sortedElements:o}=this;let i=0;for(const s of o){const r=s.lengthOptions[0];t.set(s,r),i+=r}for(const s of o)for(;i<e;){const r=t.get(s);if(!r)break;const a=s.lengthOptions.find(p=>p>r);if(!a)break;const c=i-r+a;if(c>e)break;t.set(s,a),i=c}for(const[s,r]of t)s.budgetedLength=r}_measure(){const t=this.measuredElement;this.availableLength=t?this.layout==="horizontal"?t.clientWidth??0:t.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}};n([l()],P.prototype,"measuredElement",void 0),n([l()],P.prototype,"managedElements",void 0),n([l()],P.prototype,"_sortedElements",null),n([l()],P.prototype,"availableLength",void 0),n([l()],P.prototype,"layout",void 0),P=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],P);const nt=P,lt={splitButtonBase:"esri-split-button--split-part"};let L=class extends Y(D){constructor(e){super(e),this.messagesCommon=null}loadDependencies(){return W({action:()=>M(()=>import("./index-uo3QRyij.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),"action-group":()=>M(()=>import("./index-CeuWjGvT.js").then(e=>e.i),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,24,25])),"action-menu":()=>M(()=>import("./index-D4v05KrG.js").then(e=>e.i),__vite__mapDeps([24,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,25]))})}get minimumLength(){const e=this.actionChildren;return e.length?e.length===1?w.action[this.scale]+w.groupSeparator:w.action[this.scale]+w.splitButtonPart[this.layout][this.scale]+w.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:o,layout:i,scale:s,priority:r}=this;if(e.length<2||r<0)return[o];const a=w.groupSeparator+w.action[s]*e.length;return[w.groupSeparator+w.action[s]+w.splitButtonPart[i][s],a]}render(){if(!this.actionChildren.length)return u(de,null,void 0);const{actionChildren:e,minimumLength:o,budgetedLength:i,layout:s,slot:r}=this,a=e.length<2||i>o;return u("calcite-action-group",{key:"split-button-group",layout:s,onclick:c=>this._handleClick(c.target),slot:r},a?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:o,actionChildren:i,scale:s,messagesCommon:r}=this,a=e??i.at(0);if(!a)return;const c=i.filter(p=>p!==a);return[this._renderManagedAction(a),u("calcite-action-menu",{key:"split-button-dropdown",label:r.more,overlayPositioning:"fixed",placement:o==="horizontal"?"bottom-end":"right-end"},u("calcite-action",{class:`${lt.splitButtonBase}--${o}--${this.scale}`,compact:o==="horizontal",icon:fe.splitButton[o],key:"split-button-dropdown-trigger",scale:s,slot:"trigger",text:r.more}),c==null?void 0:c.map(p=>this._renderManagedAction(p)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){var o,i;return u("calcite-action",{...e==null?void 0:e.properties,"data-action-key":(o=e==null?void 0:e.properties)==null?void 0:o.key,text:((i=e==null?void 0:e.properties)==null?void 0:i.text)??""})}};L.vnodeSelector="calcite-action-group",n([l()],L.prototype,"minimumLength",null),n([l()],L.prototype,"lengthOptions",null),n([l(),H("esri/t9n/common")],L.prototype,"messagesCommon",void 0),L=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],L);const C="esri-responsive-toolbar",k={rulerBase:`${C}__ruler`,rulerBarHorizontal:`${C}__ruler--bar`,rulerBarVertical:`${C}__ruler--bar--vertical`,rulerPadVertical:`${C}__ruler--pad--vertical`,rulerPadHorizontal:`${C}__ruler--pad--horizontal`,bar:`${C}__bar`,barHorizontal:`${C}__bar--horizontal`,barVertical:`${C}__bar--vertical`,pad:`${C}__pad`,padVertical:`${C}__pad--vertical`,padHorizontal:`${C}__pad--horizontal`};let R=class extends D{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new nt,this._managedWidgets=new Map}loadDependencies(){return W({"action-bar":()=>M(()=>import("./index-DP7sB_Vc.js"),__vite__mapDeps([26,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,24,25,15,27])),"action-pad":()=>M(()=>import("./index-DCaoM_3N.js"),__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,16,17,18,19,20,21,22,23,24,25,15,27]))})}destroy(){this._measurementManager=Q(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const o=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),o!==e&&this.scheduleRender()}render(){const{layout:e,scale:o,barStyle:i}=this,s={layout:e,scale:o,expandDisabled:!0,key:"measured-toolbar"},r=i==="docked"?e==="vertical"?k.rulerBarVertical:k.rulerBarHorizontal:e==="horizontal"?k.rulerPadHorizontal:k.rulerPadVertical;return u("div",null,u("div",{afterCreate:a=>{var c;(c=this._measurementManager)==null||c.connect(a)},class:this.classes(k.rulerBase,r)}),i==="docked"?u("calcite-action-bar",{...s,classes:{[k.barHorizontal]:this.layout==="horizontal",[k.barVertical]:this.layout==="vertical",[k.bar]:!0},overflowActionsDisabled:!0},this._renderChildren()):u("calcite-action-pad",{...s,class:this.classes(k.pad,e==="horizontal"?k.padHorizontal:k.padVertical)},this._renderChildren()))}_renderChildren(){var s;if(!this.children)return;const e=this.children.filter(r=>{var a;return((a=r.properties)==null?void 0:a.key)!==void 0&&"group-kind"in r.properties}),o=new Set,i=e.map(r=>{const a=r.properties,c=a.key;o.add(c);const p=this.barStyle==="docked"?a.slot??void 0:void 0,d=a.priority??0,v=a["group-kind"]??"overflow-group",_=a["allow-collapse"]??!0,g=this._managedWidgets.get(c);if(g)return g.children=r.children,g.priority=d,"allowCollapse"in g&&(g.allowCollapse=_),g.slot=p,g.layout=this.layout,g.scale=this.scale,g.measurementManager=this._measurementManager,g;const y={scale:this.scale,priority:d,measurementManager:this._measurementManager,children:r.children,slot:p,layout:this.layout};switch(v){case"split-button":{const f=new L({...y});return this._managedWidgets.set(c,f),f}case"overflow-group":{const f=new rt({...y,allowCollapse:_});return this._managedWidgets.set(c,f),f}case"measured-content":{const f=new st({...y});return this._managedWidgets.set(c,f),f}}}).filter(he);return Array.from(this._managedWidgets.keys()).filter(r=>!o.has(r)).forEach(r=>{var a;(a=this._managedWidgets.get(r))==null||a.destroy(),this._managedWidgets.delete(r)}),(s=this._measurementManager)==null||s.allocate(),i.map(r=>r.render())}};n([l()],R.prototype,"scale",void 0),n([l({value:"horizontal"})],R.prototype,"layout",null),n([l()],R.prototype,"barStyle",void 0),n([l()],R.prototype,"_measurementManager",void 0),n([l()],R.prototype,"_managedWidgets",void 0),R=n([O("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],R);const le=R;let b=class extends pe{constructor(e){super(e),this.coordinates=void 0,this.strokeDash=[],this.strokeWidth=1,this.strokeColor=[0,0,0,1],this.strokeDashColor=[255,255,255,1],this.fillColor=[0,0,0,0],this.visible=!0,this.isDecoration=!0}get _strokeStyle(){const e=this.strokeColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _strokeBackgroundStyle(){const e=this.strokeDashColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _fillStyle(){const e=this.fillColor;return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}get _renderCoordinates(){const e=[];if(!this.coordinates)return{coordinates:e,rect:ee};const o=Oe(Ce(ke(ee),this.coordinates),2*this.strokeWidth);o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.ceil(o[2]+.5),o[3]=Math.ceil(o[3]+.5);for(const i of this.coordinates)e.push([Math.floor(i[0]-o[0])+.5,Math.floor(i[1]-o[1])+.5]);return e.reverse(),{coordinates:e,rect:o}}render(){const{coordinates:e,rect:o}=this._renderCoordinates,i=$e(o),s=Se(o);return u("div",{classes:{"esri-outline-overlay-item":!0},styles:{left:o[0]+"px",top:o[1]+"px",width:i+"px",height:s+"px",visibility:this.visible?"visible":"hidden"}},u("svg",{height:s,styles:{display:"block"},width:i},u("polygon",{fill:this._fillStyle,points:e.map(([r,a])=>`${r},${a}`).join(" "),stroke:this._strokeBackgroundStyle,"stroke-width":this.strokeWidth}),u("polygon",{fill:"transparent",points:e.map(([r,a])=>`${r},${a}`).join(" "),stroke:this._strokeStyle,"stroke-dasharray":this.strokeDash.length?this.strokeDash.join(" "):void 0,"stroke-width":this.strokeWidth})))}renderCanvas(){}};n([l()],b.prototype,"coordinates",void 0),n([l()],b.prototype,"strokeDash",void 0),n([l()],b.prototype,"strokeWidth",void 0),n([l()],b.prototype,"strokeColor",void 0),n([l()],b.prototype,"strokeDashColor",void 0),n([l()],b.prototype,"fillColor",void 0),n([l()],b.prototype,"visible",void 0),n([l()],b.prototype,"isDecoration",void 0),n([l({readOnly:!0})],b.prototype,"_strokeStyle",null),n([l({readOnly:!0})],b.prototype,"_strokeBackgroundStyle",null),n([l({readOnly:!0})],b.prototype,"_fillStyle",null),n([l({readOnly:!0})],b.prototype,"_renderCoordinates",null),b=n([O("esri.views.overlay.OutlineOverlayItem")],b);const at=b;let T=class extends Z.EventedMixin(it){constructor(e){super(e),this._overlayItem=void 0,this.geometryType=null,this.mode=null,this.type="draw-screen"}initialize(){this.drawOperation=this._makeDrawOperation();const e=o=>this.drawOperation.on(o,i=>{this._updateVisuals(),this.emit(o,i)});this.addHandles([e("vertex-add"),e("vertex-remove"),e("vertex-update"),e("cursor-update"),e("complete")]),this.finishToolCreation()}destroy(){this.drawOperation=Q(this.drawOperation),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centeredToggled(e){this._set("centeredToggled",e),this._updateVisuals()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set uniformSizeToggled(e){this._set("uniformSizeToggled",e),this._updateVisuals()}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get cursor(){return this.geometryType==="point"?"default":"crosshair"}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}undo(){this.drawOperation.undo()}reset(){}_makeDrawOperation(){const{view:e}=this;return new Xe({view:e,manipulators:this.manipulators,geometryType:ct(this.geometryType),drawingMode:this.mode,hasZ:!1,defaultZ:0,snapToSceneEnabled:!1,drawSurface:new re,hasM:!1,snappingManager:null,snappingVisualizer:null,graphic:null,cursor:this.cursor})}get coordinates(){var a,c,p;const{drawOperation:e}=this;if(!(e!=null&&e.geometryIncludingUncommittedVertices.length))return[];const{coordinateHelper:o}=e,i=e.committableVertex,s=e.committedVertices.slice();i!=null&&s.push(o.pointToArray(i));const r=s.length;switch(this.geometryType){case"circle":case"rectangle":{const d=new Je(Ze,re.spatialReference),v=this.geometryType==="circle"?Ye:et,_=this.geometryType==="circle"?tt:ot;if(r===1&&e.isCompleted){const g=s[0],y=d.makeMapPoint(g[0]+dt,g[1]);return((a=v([g,y],d,!0))==null?void 0:a.geometry.rings[0])??[]}if(r===2){const g=this.geometryType!=="rectangle",y=this.centeredToggled!==g,f=this.geometryType!=="rectangle";return(this.uniformSizeToggled!==f?(c=v(s,d,y))==null?void 0:c.geometry.rings[0]:(p=_(s,d,y))==null?void 0:p.geometry.rings[0])??[]}return[]}}return s}_updateVisuals(){var e;if(!this._overlayItem){const o=new at({strokeDash:[5],strokeDashColor:[255,255,255,255]});(e=this.view.overlay)==null||e.addItem(o),this.addHandles(ve(()=>{var i;(i=this.view.overlay)==null||i.removeItem(o),o==null||o.destroy(),this._overlayItem=void 0})),this._overlayItem=o}this._overlayItem.coordinates=this.coordinates}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}};function ct(t){switch(t){case"polygon":case"point":return t;case"circle":case"rectangle":return"segment"}}n([l({value:!1})],T.prototype,"centeredToggled",null),n([l()],T.prototype,"drawOperation",void 0),n([l({value:!0})],T.prototype,"enabled",null),n([l({value:!1})],T.prototype,"uniformSizeToggled",null),n([l({constructOnly:!0})],T.prototype,"geometryType",void 0),n([l({constructOnly:!0})],T.prototype,"mode",void 0),n([l({readOnly:!0})],T.prototype,"type",void 0),n([l({readOnly:!0})],T.prototype,"updating",null),n([l({constructOnly:!0,nonNullable:!0})],T.prototype,"view",void 0),n([l()],T.prototype,"cursor",null),T=n([O("esri.views.draw.DrawScreenTool")],T);const dt=48;async function pt(){return M(()=>import("./geometryEngineJSON-Bvf5zUh7.js").then(t=>t.g),__vite__mapDeps([29,30,31,32]))}async function ut(){return pt().then(({contains:t,intersects:e,overlaps:o,simplify:i})=>({contains:t,intersects:e,overlaps:o,simplify:i}))}async function ht(t){const{currentSelection:e,selector:o,signal:i,sources:s,view:r}=t;if(!(s!=null&&s.length))return{added:[],removed:[]};const{layers:a,layerViews:c,graphicsLayers:p}=yt(s),d=(await X(Promise.all([gt(o,a,r,i),mt(o,c,r,i),vt(o,p,r)]),i)).flat();if(!e)return{added:d,removed:[]};const v=e.toArray(),_=d.filter(y=>!ae(v,y)),g=v.filter(y=>!ae(d,y));return e.removeMany(g),e.addMany(_),{added:_,removed:g}}const vt=async(t,e,o)=>bt({candidates:e.flatMap(i=>i.graphics.toArray())??[],selector:t,view:o}),gt=async(t,e,o,i)=>{const s=await G(ft({selector:t,signal:i,layers:e,view:o}));return s?be(s):[]},mt=async(t,e,o,i)=>{const s=await G(_t({selector:t,signal:i,layerViews:e,view:o}));return s?be(s):[]};function be(t){const e=[];for(let o=0;o<t.length;o++){const i=t[o];i.status==="fulfilled"&&e.push(...i.value)}return e}function yt(t){const e=[],o=[],i=[];return t.forEach(s=>{var r,a;Ee(s)?e.push(s):(ge(s)||me(s))&&((r=s.layers)!=null&&r.length)?e.push(...s.layers.toArray()):Ie(s)&&((a=s.sublayers)!=null&&a.length)?i.push(...s.sublayers.toArray()):Pe(s)?i.push(s):K(s)&&o.push(s)}),{layers:e,layerViews:o,graphicsLayers:i}}function ae(t,e){if(t.includes(e))return!0;const o=e.getObjectId(),i=o!=null,{layer:s,uid:r}=e;return i?t.some(a=>{if(s===a.layer)return o===a.getObjectId()}):t.some(a=>{if(s===a.layer)return r===a.uid})}async function _t(t){const{layerViews:e,selector:o,signal:i,view:s}=t;return X(Promise.allSettled(e.map(async r=>{const a=r.createQuery(),{geometry:c}=Te(o,r.layer,s);return a.outFields=["*"],a.geometry=c,a.returnGeometry=!0,a.outSpatialReference=s.spatialReference,r.queryFeatures(a,{signal:i}).then(({features:p})=>p)})),i)}async function ft(t){const{layers:e,selector:o,signal:i,view:s}=t;return X(Promise.allSettled(e.map(async r=>r.queryFeatures(wt(r.createQuery(),o,r,s),{signal:i}).then(({features:a})=>a))),i)}function Te(t,e,o){var p;const i="renderer"in e?Re({renderer:e.renderer}):0,s=t.type==="point"?xe(t,i,o):t,r="displayField"in e?e.displayField:null,a=Le({displayField:r,fields:e.fields}),c=[e.objectIdField];if(a!=null&&e.fieldsIndex.has(a)&&c.push(a),"globalIdField"in e&&e.globalIdField!=null&&e.fieldsIndex.has(e.globalIdField)&&c.push(e.fieldsIndex.get(e.globalIdField).name),te(e)&&e.subtypeField!=null&&e.fieldsIndex.has(e.subtypeField)&&c.push(e.fieldsIndex.get(e.subtypeField).name),"utilityNetworks"in o.map&&((p=o.map.utilityNetworks)!=null&&p.length)&&(te(e)||e.type==="feature")){const d=e.fieldsIndex.get("assetgroup"),v=e.fieldsIndex.get("assettype");d!=null&&d.name&&c.push(d.name),v!=null&&v.name&&c.push(v.name)}return{geometry:s,outFields:c}}function wt(t,e,o,i){const{outFields:s,geometry:r}=Te(e,o,i);return t.outFields=s,t.geometry=r,t.returnGeometry=!0,t.outSpatialReference=i.spatialReference,t}async function bt(t){const{selector:e,candidates:o,view:i}=t;if(!(o!=null&&o.length)||!e)return[];const{spatialReference:s}=i,r=e,a=await ut();return o.filter(c=>c.geometry&&c.geometry.type!=="mesh"&&a.intersects(s,r,c.geometry))}const Tt=100;let A=class extends Z.EventedAccessor{constructor(e){super(e),this._processTask=null,this.options=null,this.selection=new ue,this.sources=null,this._process=Ae(async(o,i)=>{const{callback:s,selector:r,completed:a}=o,c=Ve(async p=>{var y;const{options:d,sources:v,selection:_,view:g}=this;if(!(!(v!=null&&v.length)&&!(g!=null&&g.selectionManager.sources.length))&&g){if(r&&v!=null){const f=await ht({currentSelection:_,selector:r,signal:p,sources:v,view:g});a&&(d==null?void 0:d.persistSelection)!==!1&&((y=g.selectionManager)==null||y.updateSelection({current:_.toArray(),...f}))}s&&s()}else _.removeAll()});return De(i,()=>c.abort()),this._processTask=c,c.promise},Tt)}initialize(){this._setup()}cancel(){var e;this.removeAllHandles(),(e=this._processTask)==null||e.abort()}async _setup(){const{view:e}=this;if(await e.whenReady(),this.destroyed)return;const o=this.options,i=(o==null?void 0:o.createTool)??"rectangle",s=(o==null?void 0:o.mode)??(i==="polygon"?"click":"hybrid"),r=Symbol();this._tool=new T({view:e,mode:s,geometryType:i}),o!=null&&o.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>G(this._process({selector:this._selectionArea}))),r),this.addHandles([e.on("key-down",a=>{if(!a.repeat)switch(a.key){case U.constraint:this._tool.uniformSizeToggled=!0,a.stopPropagation();break;case U.center:this._tool.centeredToggled=!0,a.stopPropagation()}}),e.on("key-up",a=>{switch(a.key){case U.constraint:this._tool.uniformSizeToggled=!1,a.stopPropagation();break;case U.center:this._tool.centeredToggled=!1,a.stopPropagation()}}),this._tool.on("complete",async a=>{this.removeHandles(r);const c=()=>{this.removeAllHandles(),this.emit("complete",{aborted:a.aborted,selection:this.selection.toArray()})};a.aborted?(this.cancel(),this.selection.removeAll(),c()):await this._process({selector:this._selectionArea,callback:c,completed:!0})})],r),this.addHandles(ve(()=>e.tools.remove(this._tool))),e.addAndActivateTool(this._tool)}get _selectionArea(){const e=Be(),o=this._tool.coordinates,i=this.view.spatialReference,s=a=>{e.x=a[0],e.y=a[1];const{x:c,y:p}=this.view.toMap(e);return[c,p]};if(o.length===0)return;if(o.length===1||o.every(([a,c])=>a===o[0][0]&&c===o[0][1])){const[a,c]=s(o[0]);return new ze({x:a,y:c,spatialReference:i})}const r=o.map(s);if(r.length!==0)return He(r)||r.reverse(),new Ge({spatialReference:i,rings:[r]})}};n([l()],A.prototype,"options",void 0),n([l({readOnly:!0})],A.prototype,"selection",void 0),n([l()],A.prototype,"sources",void 0),n([l({constructOnly:!0})],A.prototype,"view",void 0),A=n([O("esri.widgets.support.Selector2D.SelectionOperation")],A);const Mt=A;let $=class extends Z.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layerViewPreferenceEnabled=!0,this.sources=null}initialize(){this.addHandles([V(()=>this._sources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=B(this._operationHandlesGroup)}get _sources(){const{layerViewPreferenceEnabled:e,sources:o,view:i}=this;return i&&(o!=null&&o.length)?o.flatMap(s=>{if(K(s))return s;if(ge(s)||me(s)){const a=s.layers||[],c=a.map(p=>{const d=oe(i,p)||void 0;return e&&K(d)?d:p});return c.length?c.toArray():a.length?a.toArray():s}if(!e)return s;const r=oe(i,s)||void 0;return K(r)?r:s}):[]}get layers(){return j(F.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){j(F.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){const{_sources:e,view:o}=this,i=!(e!=null&&e.length)&&!(o!=null&&o.selectionManager.sources.length);return this.activeOperation?"active":o!=null&&o.ready&&!i?"ready":"disabled"}cancel(){var e;this.state==="active"&&((e=this.activeOperation)==null||e.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:o,state:i,view:s}=this,r=!(o!=null&&o.length)&&!(s!=null&&s.selectionManager.sources.length);if(i==="disabled"||r||!this.view)return;i==="active"&&this.cancel();const a=new Mt({view:this.view,sources:o,options:e});return this._operationHandlesGroup=J([a.selection.on("change",c=>this.emit("selection-change",c)),a.once("complete",c=>this._onOperationComplete(c))]),this._set("activeOperation",a),a}_onOperationComplete(e){this._operationHandlesGroup=B(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};n([l()],$.prototype,"_sources",null),n([l({readOnly:!0})],$.prototype,"activeOperation",void 0),n([l()],$.prototype,"layers",null),n([l()],$.prototype,"layerViewPreferenceEnabled",void 0),n([l()],$.prototype,"sources",void 0),n([l({readOnly:!0})],$.prototype,"state",null),n([l()],$.prototype,"view",void 0),$=n([O("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],$);const Ot=$,ce={lassoTool:!0,rectangleTool:!0},N="esri-selection-toolbar",q={base:N,container:`${N}__container`,toolButton:`${N}__tool-button`};let m=class extends D{constructor(t,e){super(t,e),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.defaultLassoToolOptions={createTool:"polygon",mode:"freehand"},this.defaultRectangleToolOptions={createTool:"rectangle"},this.messages=null,this.toolConfigs=[],this.viewModel=new Ot,this.visibleElements={...ce},this.scale="s",this.layout="horizontal",this._viewModelHandlesGroup=J([this.viewModel.on("complete",o=>{this._set("activeToolInfo",null),this.emit("complete",o)})])}destroy(){this._viewModelHandlesGroup=B(this._viewModelHandlesGroup)}loadDependencies(){return W({action:()=>M(()=>import("./index-uo3QRyij.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))})}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get layers(){return j(F.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(t){j(F.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=t}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(t){this.viewModel.layerViewPreferenceEnabled=t}get sources(){return this.viewModel.sources}set sources(t){this.viewModel.sources=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...ce,...t}}get state(){return this.viewModel.state}get visibleToolCount(){const{view:t,toolConfigs:e,visibleElements:o}=this;return((e==null?void 0:e.length)??0)+((t==null?void 0:t.type)==="2d"?(o.lassoTool?1:0)+(o.rectangleTool?1:0):0)}activate(t){if(this.cancel(),this.state!=="disabled")switch(t){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(t)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return u("div",{"aria-label":this.label,class:this.classes(q.base,Fe.widget)},u("div",{class:q.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){var t;if(((t=this.view)==null?void 0:t.type)==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){var t;if((t=this.toolConfigs)!=null&&t.length)return this.toolConfigs.map(({toolName:e,icon:o,toolKey:i})=>this._renderToolWithTooltip(e,i,o))}_renderLassoTool(){const{messages:t,visibleElements:e}=this;if(!e.lassoTool)return;const o=t.selectByLasso;return this._renderToolWithTooltip("lasso","lasso","lasso-select",o)}_renderRectangleTool(){const{messages:t,visibleElements:e}=this;if(!e.rectangleTool)return;const o=t.selectByRectangle;return this._renderToolWithTooltip("rectangle","rectangle","cursor-marquee",o)}_renderToolWithTooltip(t,e,o,i=t){var r;const s=`${this.id}-tool-${e}`;return u("calcite-action",{active:((r=this.activeToolInfo)==null?void 0:r.toolName)===t,bind:this,class:q.toolButton,disabled:this.state==="disabled",icon:o||"selection",id:s,key:s,onclick:()=>this._toggleTool(t),scale:this.scale,text:i,title:i})}_activateTool(t){const e=this._getToolOptions(t);if(!e)return;const o=this.viewModel.activate(e);o&&this._set("activeToolInfo",{toolName:t,operation:o})}_toggleTool(t){if(this.activeToolInfo){const e=this.activeToolInfo.toolName;if(this.cancel(),e===t)return}this._activateTool(t)}_getToolOptions(t){return t==="lasso"?this.defaultLassoToolOptions:t==="rectangle"?this.defaultRectangleToolOptions:this.toolConfigs.find(e=>e.toolName===t)}};n([l({readOnly:!0})],m.prototype,"activeToolInfo",void 0),n([l()],m.prototype,"defaultLassoToolOptions",void 0),n([l()],m.prototype,"defaultRectangleToolOptions",void 0),n([l()],m.prototype,"label",null),n([l()],m.prototype,"layers",null),n([l()],m.prototype,"layerViewPreferenceEnabled",null),n([l(),H("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],m.prototype,"messages",void 0),n([l()],m.prototype,"sources",null),n([l()],m.prototype,"toolConfigs",void 0),n([l()],m.prototype,"view",null),n([l()],m.prototype,"viewModel",void 0),n([l()],m.prototype,"visibleElements",void 0),n([We("visibleElements")],m.prototype,"castVisibleElements",null),n([l()],m.prototype,"scale",void 0),n([l()],m.prototype,"state",null),n([l()],m.prototype,"layout",void 0),n([l()],m.prototype,"visibleToolCount",null),m=n([O("esri.widgets.support.SelectionToolbar")],m);const Ct=m,E="esri-sketch",S={base:E,vertical:`${E}--vertical`,docked:`${E}-bar`,floating:`${E}-pad`,chipHorizontal:`${E}__selection-count-chip--horizontal`,chipVertical:`${E}__selection-count-chip--vertical`,chipVerticalSmall:`${E}__selection-count-chip--vertical--s`,popoverWrapper:`${E}__popover-wrapper`},kt={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3-d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let h=class extends D{constructor(t,e){super(t,e),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new ye,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=(t==null?void 0:t.viewModel)||(this._defaultViewModel=new _e({creationMode:(t==null?void 0:t.creationMode)??"continuous"}))}initialize(){const{layer:t,view:e}=this,o=new Ct({view:(e==null?void 0:e.type)==="2d"?e:null,sources:t?[t]:null,scale:this.scale});this.addHandles([V(()=>this.viewModel,i=>{this._viewModelHandlesGroup=B(this._viewModelHandlesGroup),i&&(this._viewModelHandlesGroup=J([i.on("create",()=>this.scheduleRender()),i.on("update",()=>this.scheduleRender()),i.on("delete",s=>this.emit("delete",s)),i.on("undo",()=>this.scheduleRender()),i.on("redo",()=>this.scheduleRender()),V(()=>i.layer,s=>{this._selectionToolbar&&(this._selectionToolbar.sources=s?[s]:null)}),V(()=>i.view,s=>{this._selectionToolbar&&(this._selectionToolbar.view=(s==null?void 0:s.type)==="2d"?s:null)}),V(()=>i.state,()=>this.notifyChange("state"))]))},ie),Ue(()=>o.activeToolInfo,()=>this.viewModel.cancel()),o.on("complete",i=>this._onSelectionOperationComplete(i)),V(()=>{const{selectionTools:i}=this.visibleElements;return{lassoTool:!!(i!=null&&i["lasso-selection"]),rectangleTool:!!(i!=null&&i["rectangle-selection"])}},i=>{Object.assign(o.visibleElements,i)},ie)]),this._selectionToolbar=o}loadDependencies(){return W({action:()=>M(()=>import("./index-uo3QRyij.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])),chip:()=>M(()=>import("./index-Bp_8Rx7Z.js"),__vite__mapDeps([33,6,2,3,7,8,9,12,11,14,13,23,5])),popover:()=>M(()=>import("./index-W1Nzc8kd.js").then(t=>t.i),__vite__mapDeps([16,1,2,3,4,5,6,7,8,9,0,10,11,12,13,14,17,18,19,20,21,22,23]))})}destroy(){var t;(t=this._selectionToolbar)==null||t.destroy(),this._viewModelHandlesGroup=B(this._viewModelHandlesGroup)}get activeTool(){var s;const t=(s=this._selectionToolbar)==null?void 0:s.activeToolInfo;if(t)switch(t.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const e=this._effectiveAvailableCreateTools,{activeTool:o,activeCreateToolDrawMode:i}=this.viewModel;return o==="polygon"&&i==="freehand"&&(e!=null&&e.includes("freehandPolygon"))?"freehandPolygon":o==="polyline"&&i==="freehand"&&(e!=null&&e.includes("freehandPolyline"))?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(t){this.viewModel.creationMode=t}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(t){this.viewModel.defaultUpdateOptions=t}get icon(){return"pencil"}set icon(t){this._overrideIfSome("icon",t)}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(t){this.viewModel.labelOptions=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}set layout(t){this._set("layout",t),this._selectionToolbar&&(this._selectionToolbar.layout=t)}set scale(t){this._set("scale",t),this._selectionToolbar&&(this._selectionToolbar.scale=t)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get state(){var t;return(t=this._selectionToolbar)!=null&&t.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(t){this.viewModel.tooltipOptions=t}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(t){this.viewModel.valueOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}set viewModel(t){const e=this._get("viewModel");t!==e&&(e&&e===this._defaultViewModel&&Q(e),this._set("viewModel",t))}get _effectiveAvailableCreateTools(){const{availableCreateTools:t,view:e,visibleElements:o}=this,i=t==null?void 0:t.filter(s=>{var r;return!!((r=o.createTools)!=null&&r[s])});return(e==null?void 0:e.type)==="3d"?i==null?void 0:i.filter(s=>s!=="multipoint"):i}create(t,e,o){const i=(o==null?void 0:o.createOptions)??e;return this._activeCustomToolOptions=o,G(this.viewModel.create(t,i))}update(t,e){return G(this.viewModel.update(t,e))}complete(){this.viewModel.complete()}cancel(){var t;(t=this._selectionToolbar)==null||t.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){var t;this.viewModel.undo(),(t=this.view)==null||t.focus()}redo(){var t;this.viewModel.redo(),(t=this.view)==null||t.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){var s,r,a;const{toolbarKind:t,layout:e,scale:o}=this,i=(s=this.customActions)==null?void 0:s.filter(c=>c.position==="selection-toolbar");return u("div",null,u("div",{classes:{[S.base]:!0,[S.floating]:t==="floating",[S.docked]:t==="docked",[S.vertical]:e==="vertical"}},u(le,{barStyle:t,layout:e,scale:o},this._renderSelectionSetItemGroupInline(),u("div",{"group-kind":"split-button",key:"selection-split-button",priority:((r=this.groupCollapsePriorities)==null?void 0:r.get("selectionTools"))??z.Low},this._renderDefaultSelectionButton(),(a=this._selectionToolbar)==null?void 0:a.render(),i==null?void 0:i.map(c=>this._renderToolbarItem(c))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:t,snappingOptions:e,view:o,viewModel:i,visibleElements:s}=this;if(!this._calcitePopoverReferenceElement)return;const r={directionModePicker:s.directionModePicker,labelsToggle:s.labelsToggle,tooltipsToggle:s.tooltipsToggle},a=this.layout==="horizontal"?this._relativeLocation==="top"?"bottom-end":"top-end":"right-end";return u("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:t.settings,label:t.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:a,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:c=>this._remeasurePopoverSizes(c.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},u("div",{class:S.popoverWrapper},Object.values(r).includes(!0)?u(Ke,{sketchOptions:i.sketchOptions,viewType:o==null?void 0:o.type,visibleElements:new je(r)}):void 0,s.snappingControls&&o&&e?u(Ne,{snappingManager:this.viewModel.snappingManager,snappingOptions:e,view:o,visibleElements:s.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if(this.contextualToolLocation!=="separate")return;const t=this._renderSelectionSetItemGroup();return t!=null&&t.length?u(le,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},t):void 0}_renderSelectionSetItemGroupInline(){return this.contextualToolLocation==="separate"?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){var t;return u("div",{"group-kind":"split-button",key:"undo-redo-menu",priority:((t=this.groupCollapsePriorities)==null?void 0:t.get("undoRedo"))??z.Medium,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){var i,s;const t=[],e=[];(i=this.customActions)==null||i.forEach(r=>{r.position==="settings-before"?e.push(r):r.position==="settings-after"&&t.push(r)});const o=[...e.map(r=>this._renderToolbarItem(r)),this._renderSettingsMenuButton(),...t.map(r=>this._renderToolbarItem(r))].filter(he);if(o.length)return u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"settings-menu",priority:((s=this.groupCollapsePriorities)==null?void 0:s.get("settings"))??z.Max,slot:"actions-end"},o)}_renderSelectionSetItemGroup(){var s,r,a;if(!this.updateGraphics.length)return[];const t=this.contextualToolLocation==="inline-end"?"actions-end":void 0,e=(s=this.customActions)==null?void 0:s.filter(c=>c.position==="before-selection-set"),o=(r=this.customActions)==null?void 0:r.filter(c=>c.position==="after-selection-set"),i=((a=this.groupCollapsePriorities)==null?void 0:a.get("selectionSet"))??z.High;return[u("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:i,slot:t},this._renderFeatureCountChip()),u("div",{"allow-collapse":!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:i,slot:t},e==null?void 0:e.map(c=>this._renderToolbarItem(c)),this._renderDuplicateButton(),this._renderDeleteButton(),o==null?void 0:o.map(c=>this._renderToolbarItem(c)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:t,state:e}=this;return this._renderToolbarItem({id:"pointer-select",text:t.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:e==="ready"})}_renderCreateToolActionGroup(){var o,i,s;const t=((o=this._effectiveAvailableCreateTools)==null?void 0:o.flatMap(r=>this._renderBuiltInCreateToolItem(r)))??[],e=((i=this.customToolOptions)==null?void 0:i.flatMap(r=>this._renderCustomToolItem(r)))??[];return u("div",{"group-kind":"overflow-group",key:"create-tools-group",priority:((s=this.groupCollapsePriorities)==null?void 0:s.get("createTools"))??z.High},t,e)}_renderBuiltInCreateToolItem(t){return this._renderToolbarItem({id:`${t}-button`,text:this.messages.draw[t],icon:kt[t],onclick:()=>this._activateCreateTool(t),active:this.activeTool===t&&!this._activeCustomToolOptions})}_renderCustomToolItem(t){var o;const{toolKey:e}=t;return this._renderToolbarItem({id:`custom-${t.toolKey}`,text:t.label,icon:t.icon,onclick:()=>this._activateCreateTool(t.toolName,null,t),active:((o=this._activeCustomToolOptions)==null?void 0:o.toolKey)===e})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:t=>this._calcitePopoverReferenceElement=t,afterUpdate:t=>this._calcitePopoverReferenceElement=t,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:t,messages:e,scale:o,id:i,updateGraphics:{length:s}}=this,r=se(e.selectedCount,{count:s}),a=o==="s"?99:999,c=s>a?se(e.selectedCountTruncated,{truncated:a}):s,p=o==="s"&&t==="vertical",d=p?`${i}-selection-chip-small`:`${i}-selection-chip`;return[p?u("span",{classes:{[S.chipVertical]:!0,[S.chipVerticalSmall]:this.scale==="s"},id:d,tabIndex:0,title:r},c):u("calcite-chip",{appearance:"outline",class:t==="horizontal"?S.chipHorizontal:S.chipVertical,id:d,kind:"brand",label:r,scale:o==="l"?"m":"s",tabIndex:0,title:t==="vertical"?r:void 0},t==="vertical"?c:r)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:t}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?t.duplicateFeatures:t.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:t}=this,e=this.updateGraphics.length>1?t.deleteFeatures:t.deleteFeature;return this._renderToolbarItem({id:"delete",text:e,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:t,text:e,icon:o,disabled:i,onclick:s,active:r,flipRTL:a,afterCreate:c,afterUpdate:p,afterRemoved:d}){const v=`${this.id}-${t}`;return[u("calcite-action",{active:r,afterCreate:c,afterRemoved:d,afterUpdate:p,bind:this,"data-testid":t,disabled:i||this.state==="disabled",icon:o,iconFlipRtl:a??!1,id:v,key:t,onclick:s,scale:this.scale,text:e,title:e})]}_remeasurePopoverSizes(t){var e,o,i,s,r,a;try{const c=t.parentElement,p=(o=(e=this==null?void 0:this.view)==null?void 0:e.container)==null?void 0:o.getBoundingClientRect(),d=c==null?void 0:c.style;if(!(c&&p&&d&&((s=(i=this.view)==null?void 0:i.container)!=null&&s.contains(c))))return;const v=this._calcitePopoverReferenceElement;if(!v)return;const{bottom:_,top:g}=v.getBoundingClientRect();if(this.layout==="horizontal"){const f=_<p.height/2;f!==(this._relativeLocation==="top")&&(this._relativeLocation=f?"top":"bottom"),f?(d==null||d.setProperty("--sketch-view-height-offset",_-p.top+"px"),d==null||d.setProperty("--sketch-view-margin-offset","30px")):(d==null||d.setProperty("--sketch-view-height-offset",p.bottom-g+"px"),d==null||d.setProperty("--sketch-view-margin-offset","15px"))}else this.layout==="vertical"&&(d.setProperty("--sketch-view-height-offset","15px"),d.setProperty("--sketch-view-margin-offset","15px"));const y=(a=(r=t.shadowRoot)==null?void 0:r.querySelector("div.header"))==null?void 0:a.getBoundingClientRect().height;d.setProperty("--sketch-popover-header-offset",`${y}px`)}catch(c){F.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",c)}}_activateCreateTool(t,e,o){var s;const i=this._activeCustomToolOptions;if(o||i){if((o==null?void 0:o.toolKey)===(i==null?void 0:i.toolKey))return void this.cancel()}else if(this.activeTool===t)return void this.cancel();(s=this._selectionToolbar)==null||s.cancel(),this.create(t,e,o)}_onDuplicateSelect(){const t=this.duplicate(),e=this.viewModel.activeTool;e!=="transform"&&e!=="reshape"||this.update(t,{tool:e})}_onSelectionOperationComplete(t){const{viewModel:{defaultUpdateOptions:e}}=this,{selection:o}=t;if(!t.aborted&&o.length){const i=e.tool,s=o.length>1&&i==="reshape"?"transform":i;this.update(o,{...e,tool:s})}this.notifyChange("state")}_activateDefaultSelectTool(){var t;this.cancel(),(t=this.view)==null||t.focus()}_refocusOnView(){var t;this.activeTool&&((t=this.view)==null||t.focus())}};n([l()],h.prototype,"_activeCustomToolOptions",void 0),n([l()],h.prototype,"activeTool",null),n([l({readOnly:!0})],h.prototype,"activeTooltip",null),n([l({cast:t=>{if(!(t!=null&&t.length))return null;const e=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return t.filter(o=>e.has(o))}})],h.prototype,"availableCreateTools",void 0),n([l({readOnly:!0})],h.prototype,"createGraphic",null),n([l()],h.prototype,"creationMode",null),n([l()],h.prototype,"customToolOptions",void 0),n([l()],h.prototype,"customActions",void 0),n([l()],h.prototype,"defaultCreateOptions",null),n([l()],h.prototype,"defaultUpdateOptions",null),n([l()],h.prototype,"icon",null),n([l()],h.prototype,"label",null),n([l()],h.prototype,"labelOptions",null),n([l()],h.prototype,"layer",null),n([l({type:["horizontal","vertical"],value:"horizontal"})],h.prototype,"layout",null),n([l({value:"m"})],h.prototype,"scale",null),n([l()],h.prototype,"toolbarKind",void 0),n([l()],h.prototype,"contextualToolLocation",void 0),n([l()],h.prototype,"groupCollapsePriorities",void 0),n([l(),H("esri/widgets/Sketch/t9n/Sketch")],h.prototype,"messages",void 0),n([l(),H("esri/t9n/common")],h.prototype,"messagesCommon",void 0),n([l()],h.prototype,"snappingOptions",null),n([l()],h.prototype,"state",null),n([l()],h.prototype,"tooltipOptions",null),n([l({readOnly:!0})],h.prototype,"updateGraphics",null),n([l({type:qe,nonNullable:!0})],h.prototype,"valueOptions",null),n([l()],h.prototype,"view",null),n([l({type:_e}),Qe(["create","update","undo","redo"])],h.prototype,"viewModel",null),n([l({type:ye,nonNullable:!0})],h.prototype,"visibleElements",void 0),n([l()],h.prototype,"_effectiveAvailableCreateTools",null),n([l()],h.prototype,"_defaultViewModel",void 0),n([l()],h.prototype,"_calcitePopoverReferenceElement",void 0),n([l()],h.prototype,"_relativeLocation",void 0),n([l()],h.prototype,"_popoverOpen",void 0),h=n([O("esri.widgets.Sketch")],h);const Nt=h;export{Nt as default};
